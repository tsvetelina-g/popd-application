<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist - popd</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/artist.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/favicon.ico">
</head>
<body>
<header class="site-header">
    <div class="container">
        <div class="header-bar">
            <div class="logo-section">
                <a class="logo" href="/">
                    <img src="https://dl.dropboxusercontent.com/scl/fi/w1ql10wqc755r981aodun/Popd-logo-new.png?rlkey=ln1va7jaaqb5s8p7cqfi9d4v5&st=53c30za0"
                         alt="POPd Logo" class="logo-image">
                </a>
            </div>
            <div class="header-top">
                <div class="search-section">
                    <form class="search-bar" action="/find" method="get" role="search">
                        <input type="text" name="query"
                               placeholder="Search Movies or Artists"
                               aria-label="Search Movies or Artists">
                        <button type="submit">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </form>
                </div>

                <nav class="nav">
                    <span sec:authorize="isAnonymous()">
                        <a href="/login">Login</a>
                        <span class="nav-separator">|</span>
                        <a href="/register">Register</a>
                    </span>
                    <div class="dropdown" sec:authorize="isAuthenticated()">
                        <a href="/profile" class="profile-btn">
                            <i class="fa-solid fa-user"></i>
                            Profile
                            <i class="fa-solid fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="/profile">Profile</a>
                            <a href="/logout">Logout</a>
                        </div>
                    </div>
                    <span class="nav-separator" sec:authorize="hasRole('ADMIN')">|</span>
                    <div class="dropdown" sec:authorize="hasRole('ADMIN')">
                        <a href="/admin" class="profile-btn">
                            <i class="fa-solid fa-gear"></i>
                            Admin
                            <i class="fa-solid fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="/movie/add">Add Movie</a>
                            <a href="/artist/add">Add Artist</a>
                            <a href="/admin/users">Manage Users</a>
                            <a href="/admin">Admin Panel</a>
                        </div>
                    </div>
                    <a href="/movies" class="nav-button">Movies</a>
                </nav>
            </div>
        </div>
    </div>
</header>

<main class="container">
    <section class="artist-section">
        <div class="artist-container">
            <div class="artist-header"
                 th:style="${artist.imageUrl != null and !#strings.isEmpty(artist.imageUrl)} ? '--bg-image-url:url(' + ${artist.imageUrl} + '); --show-overlay:1;' : '--bg-image-url:none; --show-overlay:0;'">
                <div class="artist-picture">
                    <img th:src="${artist.imageUrl != null and !#strings.isEmpty(artist.imageUrl) ? artist.imageUrl : 'https://dl.dropboxusercontent.com/scl/fi/n6js2mekqny5wlsr8pl7k/User-image-default.png?rlkey=snhcvubwp3rpko1ei3sotym0u&st=q23rykyl'}"
                         alt="Artist Picture" class="artist-image">
                </div>
                <div class="artist-info">
                    <h1 class="artist-name" th:text="${artist.name}">Artist Name</h1>
                    <div class="artist-birthdate-container">
                        <p class="artist-birthdate" th:text="${artist.birthDate != null ? 'Born: ' + #temporals.format(artist.birthDate, 'MMMM dd, yyyy', T(java.util.Locale).ENGLISH) : 'Born: N/A'}">Born: January 1, 1980</p>
                    </div>
                    <a sec:authorize="hasRole('ADMIN')" th:href="@{'/artist/' + ${artist.id} + '/edit'}" class="action-button edit-button">
                        <i class="fas fa-edit"></i>
                        Edit Artist Profile
                    </a>
                    <div class="artist-biography">
                        <h3 class="biography-title">Biography</h3>
                        <p class="biography-text" th:text="${artist.biography != null and !#strings.isEmpty(artist.biography) ? artist.biography : 'N/A'}">
                            This is where the artist's biography will be displayed. It can contain multiple paragraphs
                            describing the artist's career, achievements, and background information. The biography
                            provides context about the artist's work in the entertainment industry.
                        </p>
                    </div>
                </div>

                <div class="artist-stats">
                    <div class="stat-item">
                        <span class="stat-number" th:text="${movieCreditsCount}">8</span>
                        <span class="stat-label">Movie Credits</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Credits Section with Dropdown -->
        <div class="credits-section">
            <div class="credits-header">
                <h2 class="credits-title">Credits</h2>
                <select id="role-select"
                        class="role-select"
                        th:if="${creditsByRole != null and !creditsByRole.isEmpty()}">
                    <option th:each="roleEntry, iterStat : ${creditsByRole}"
                            th:value="${roleEntry.key.name()}"
                            th:text="${roleEntry.key.displayName}"
                            th:selected="${iterStat.index == 0}">
                    </option>
                </select>
            </div>
            <div id="credits-list" class="credits-list">
                <p class="no-credits-message"
                   th:style="${creditsByRole != null and !creditsByRole.isEmpty()} ? 'display: none;' : 'display: block;'">
                    No credits yet.
                </p>

                <div th:if="${creditsByRole != null and !creditsByRole.isEmpty()}">
                    <div th:each="roleEntry : ${creditsByRole}">
                        <div th:each="credit : ${roleEntry.value}"
                             class="credit-item"
                             th:attr="data-role=${roleEntry.key.name()}">
                            <a th:href="@{'/movie/' + ${credit.movie.id}}" class="credit-link">
                                <span class="credit-movie-title" th:text="${credit.movie.title}">Movie Title</span>
                                <span class="credit-year"
                                      th:text="${credit.movie.releaseDate != null ? '(' + #temporals.format(credit.movie.releaseDate, 'yyyy') + ')' : ''}">
                                    (2024)
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
</main>

<footer class="site-footer">
    <div class="container">
        <p>&copy; <span>2025</span> popd</p>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const roleSelect = document.getElementById('role-select');
        const creditsList = document.getElementById('credits-list');
        const creditItems = creditsList ? creditsList.querySelectorAll('.credit-item') : [];
        const noCreditsMessage = creditsList ? creditsList.querySelector('.no-credits-message') : null;
        
        if (!roleSelect || !creditsList) {
            return;
        }
        
        function filterCredits(selectedRole) {
            // Hide all credit items
            creditItems.forEach(item => {
                item.style.display = 'none';
            });
            
            // Hide the "no credits" message
            if (noCreditsMessage) {
                noCreditsMessage.style.display = 'none';
            }
            
            // Show credit items for the selected role
            let foundCredits = false;
            creditItems.forEach(item => {
                if (item.getAttribute('data-role') === selectedRole) {
                    item.style.display = 'block';
                    foundCredits = true;
                }
            });

            if (!foundCredits && noCreditsMessage) {
                noCreditsMessage.style.display = 'block';
            }
        }
        
        // Set up change event listener
        roleSelect.addEventListener('change', function() {
            filterCredits(this.value);
        });
        
        // Initialize with default selected role (actor)
        filterCredits(roleSelect.value);
    });
</script>
</body>
</html>

