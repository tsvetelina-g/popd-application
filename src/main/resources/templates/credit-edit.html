<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Credits - popd</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/movie.css">
    <link rel="stylesheet" href="/css/credit-edit.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/favicon.ico">
</head>
<body>
<header class="site-header">
    <div class="container">
        <div class="header-bar">
            <div class="logo-section">
                <a class="logo" href="/">
                    <img src="https://dl.dropboxusercontent.com/scl/fi/w1ql10wqc755r981aodun/Popd-logo-new.png?rlkey=ln1va7jaaqb5s8p7cqfi9d4v5&st=53c30za0"
                         alt="POPd Logo" class="logo-image">
                </a>
            </div>
            <div class="header-top">
                <div class="search-section">
                    <form class="search-bar" action="/find" method="get" role="search">
                        <input type="text" name="query"
                               placeholder="Search Movies or Artists"
                               aria-label="Search Movies or Artists">
                        <button type="submit">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </form>
                </div>

                <nav class="nav">
                    <span sec:authorize="isAnonymous()">
                        <a href="/login">Login</a>
                        <span class="nav-separator">|</span>
                        <a href="/register">Register</a>
                    </span>
                    <div class="dropdown" sec:authorize="isAuthenticated()">
                        <a href="/profile" class="profile-btn">
                            <i class="fa-solid fa-user"></i>
                            Profile
                            <i class="fa-solid fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="/profile">Profile</a>
                            <form th:action="@{/logout}" method="post" class="logout-form">
                                <button type="submit" class="logout-link">Logout</button>
                            </form>
                        </div>
                    </div>
                    <span class="nav-separator" sec:authorize="hasRole('ADMIN')">|</span>
                    <div class="dropdown" sec:authorize="hasRole('ADMIN')">
                        <a href="/admin" class="profile-btn">
                            <i class="fa-solid fa-gear"></i>
                            Admin
                            <i class="fa-solid fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu">
                            <a href="/movie/add">Add Movie</a>
                            <a href="/artist/add">Add Artist</a>
                            <a href="/admin/users">Manage Users</a>
                            <a href="/admin">Admin Panel</a>
                        </div>
                    </div>
                    <a href="/movies" class="nav-button">Movies</a>
                </nav>
            </div>
        </div>
    </div>
</header>

<main class="container">
    <section class="credit-edit-section">
        <div class="credit-edit-container">
            <div class="credit-edit-header">
                <h1 class="credit-edit-title">
                    <span class="movie-name" th:text="${movie != null ? movie.title : ''}"></span>
                    <span class="movie-name-text-below">Edit credits for this movie</span>
                </h1>
            </div>

            <!-- Credits Section with Dropdown -->
            <div class="credits-section">
                <div class="credits-header">
                    <div class="credits-header-left">
                        <h2 class="credits-title">Credits</h2>
                        <a sec:authorize="hasRole('ADMIN')" th:href="'/credit/' + ${movie.id} + '/add'" class="action-button edit-credits-button">
                            <i class="fas fa-plus"></i>
                            Add Credit
                        </a>
                    </div>
                    <select id="role-select" class="role-select">
                        <option value="ACTOR" selected>Cast</option>
                        <option value="DIRECTOR">Director</option>
                        <option value="WRITER">Writer</option>
                        <option value="PRODUCER">Producer</option>
                        <option value="CINEMATOGRAPHER">Cinematographer</option>
                        <option value="EDITOR">Editor</option>
                        <option value="COMPOSER">Composer</option>
                        <option value="COSTUME_DESIGNER">Costume Designer</option>
                        <option value="PRODUCTION_DESIGNER">Production Designer</option>
                        <option value="VISUAL_EFFECTS">Visual Effects</option>
                        <option value="SOUND_DESIGNER">Sound Designer</option>
                        <option value="MAKEUP_ARTIST">Makeup Artist</option>
                        <option value="STUNT_COORDINATOR">Stunt Coordinator</option>
                        <option value="CHOREOGRAPHER">Choreographer</option>
                        <option value="CASTING_DIRECTOR">Casting Director</option>
                    </select>
                </div>
                <div id="credits-list" class="credits-list">
                    <p class="no-credits-message" style="display: none;">No credits yet.</p>

                    <!-- Credit items for each role -->
                    <div th:if="${creditsByRole != null and !creditsByRole.isEmpty()}">
                        <div th:each="roleEntry : ${creditsByRole}" class="credits-images-row">
                            <div th:each="credit : ${roleEntry.value}"
                                 class="credit-item"
                                 th:attr="data-role=${roleEntry.key.name()}">
                                <a th:href="@{'/artist/' + ${credit.artist.id}}" class="credit-link">
                                    <div class="credit-image-container">
                                        <img th:src="${credit.artist.imageUrl != null and !#strings.isEmpty(credit.artist.imageUrl) ? credit.artist.imageUrl : 'https://dl.dropboxusercontent.com/scl/fi/n6js2mekqny5wlsr8pl7k/User-image-default.png?rlkey=snhcvubwp3rpko1ei3sotym0u&st=q23rykyl'}"
                                             th:alt="${credit.artist.name}"
                                             class="credit-artist-image">
                                    </div>
                                    <span class="credit-artist-name"
                                          th:text="${credit.artist.name}">Artist Name</span>
                                </a>
                                <form sec:authorize="hasRole('ADMIN')" th:action="@{'/credit/' + ${credit.id} + '/delete'}" th:method="delete" class="delete-form">
                                    <button type="submit" class="action-btn delete-btn">
                                        <i class="fas fa-trash"></i>
                                        Delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="credit-edit-footer">
                <a th:href="'/movie/' + ${movie.id}" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Movie
                </a>
            </div>
        </div>
    </section>
</main>

<footer class="site-footer">
    <div class="container">
        <p>&copy; <span>2025</span> popd</p>
    </div>
</footer>

<script>
    // Credits filtering functionality
    document.addEventListener('DOMContentLoaded', function () {
        const roleSelect = document.getElementById('role-select');
        const creditsList = document.getElementById('credits-list');

        if (roleSelect && creditsList) {
            const creditItems = creditsList.querySelectorAll('.credit-item');
            const noCreditsMessage = creditsList.querySelector('.no-credits-message');

            function filterCredits(selectedRole) {
                if (!selectedRole) {
                    return;
                }

                // Hide all credit items
                creditItems.forEach(item => {
                    item.style.display = 'none';
                });

                // Hide the "no credits" message initially
                if (noCreditsMessage) {
                    noCreditsMessage.style.display = 'none';
                }

                // Show credit items for the selected role
                let foundCredits = false;
                creditItems.forEach(item => {
                    if (item.getAttribute('data-role') === selectedRole) {
                        item.style.display = 'flex';
                        foundCredits = true;
                    }
                });

                // Show message if no credits found for selected role
                if (!foundCredits && noCreditsMessage) {
                    noCreditsMessage.style.display = 'block';
                }
            }

            // Set up change event listener
            roleSelect.addEventListener('change', function () {
                filterCredits(this.value);
            });

            // Initialize with "Actor" selected (default)
            filterCredits(roleSelect.value);
        }
    });
</script>
</body>
</html>

